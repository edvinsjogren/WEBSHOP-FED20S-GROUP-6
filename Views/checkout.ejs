<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ninetynine</title>
    <link rel="stylesheet" href="/CSS/main.css" />
  </head>
  <body>
    <header><%- include("./layout/navbar.ejs") %></header>
    <main>

      <% if(messages.error) { %>
        <p><%= messages.error %></p>
      <% } %> 

      <%donationsInCart.forEach(project => { %>
        <div class="projectContainer">

          <h2><%=project.projectID.title%></h2>

          <div class="projectImgAndDesc">
            
            <div class="projectImage">
              <% project.projectID.img.forEach(img => { %>
                <!--Move img styling to suitable scss file-->
                <img
                  src="/Uploads/<%=img.path%>"
                  alt="Project Image could not be displayed"
                  height="200px"
                  width="200px"
                />
              <% }) %>
            </div>
            <div class="projectDesc">
              <p><%=project.projectID.summary%></p>
            </div>

          </div>

          <p> You are about to donate: <%=project.donationAmount%> $ to this project </p>
          <p>Do you want to edit this amount? Click the button below!</p>
          <a href="/donation/<%=project._id%>"> Edit</a>

          <form action="/checkout/delete" method="post">
            <input type="text" name="id" value="<%=project._id%>" hidden />
            <button type="submit" class="bigButton">Delete</button>
          </form>
        </div>
      <% }) %>

      <div class="totalSum">
        <h2>Total sum of donations: </h2>
        <h2><%= totalSumInCart %> $</h2>
      </div>

      <!--Activate Stripe-->
      <button type="submit" class="activateStripe bigButton"> Proceed to donation checkout! </button>

    </main>
    <footer><%- include("./layout/footer.ejs") %></footer>
  </body>

</html>

<script src="https://js.stripe.com/v3/"></script>

<script>

  var stripe = Stripe('<%=stripePublicKey%>');

  document.querySelector(".activateStripe").addEventListener( "click", ()=>{
      stripe.redirectToCheckout({ sessionId: "<%=sessionId %>" });
  })

</script>